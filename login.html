<script type="module">
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
import "./auth-manager.js";

const form = document.getElementById("signInForm");
const msg = document.getElementById("signInMessage");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    msg.style.display = "block";
    msg.innerHTML = "Signing in...";

    const auth = getAuth();

    try {
        await signInWithEmailAndPassword(auth, email, password);

        // WAIT for auth-manager to fetch role then redirect
        authManager.addAuthListener((user, data) => {
            if (!data) return;
            authManager.redirectByRole();
        });

    } catch (error) {
        msg.innerHTML = "Login failed: " + error.message;
    }
});
</script>
